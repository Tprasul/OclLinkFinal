<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KFC | –†–µ–π—Ç–∏–Ω–≥ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --bg: #121212; --bg-secondary: #1E1E1E; --card: #252525; --text: #E0E0E0; --text-light: #B0B0B0; --primary: #BB86FC; --primary-dark: #3700B3; --accent: #03DAC6; --accent-dark: #018786; --border: #333333; --shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
    .app-container { max-width: 1000px; margin: 0 auto; padding: 0 1rem; }
    .header { display: flex; justify-content: space-between; align-items: center; padding: 1.5rem 0; margin-bottom: 2rem; border-bottom: 1px solid var(--border); }
    .logo { font-size: 1.5rem; font-weight: 700; color: var(--primary); text-decoration: none; display: flex; align-items: center; gap: 0.75rem; }
    .logo-icon { color: var(--accent); }
    .back-btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.7rem 1.2rem; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; text-decoration: none; border-radius: 8px; font-weight: 500; transition: all 0.3s ease; box-shadow: var(--shadow); }
    .back-btn:hover { background: linear-gradient(135deg, var(--primary), #9B51E0); transform: translateY(-2px); box-shadow: 0 6px 16px rgba(187, 134, 252, 0.3); }
    .rating-section { padding: 3rem 0; margin: 2rem 0; }
    .rating-container { max-width: 800px; margin: 0 auto; background: var(--card); border-radius: 12px; padding: 2.5rem; box-shadow: var(--shadow); border: 1px solid var(--border); }
    .section-title { font-size: 1.8rem; margin-bottom: 2rem; color: var(--primary); font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 1rem; text-align: center; }
    .section-title i { color: var(--accent); }
    
    /* –°–¢–ò–õ–ò –î–õ–Ø –§–ò–õ–¨–¢–†–ê */
    .filter-container { margin-bottom: 2rem; }
    .filter-container label { display: block; margin-bottom: 0.75rem; font-weight: 500; color: var(--primary); }
    .filter-container select { width: 100%; padding: 0.9rem 1.25rem; border: 1px solid var(--border); border-radius: 8px; font-size: 1rem; background: var(--bg-secondary); color: var(--text); cursor: pointer; }
    .filter-container select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(187, 134, 252, 0.1); }
    
    .rating-item { display: flex; align-items: center; padding: 1.25rem; margin-bottom: 1rem; border-radius: 8px; transition: all 0.3s ease; background: var(--bg-secondary); border-left: 4px solid transparent; }
    .rating-item:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2); border-left-color: var(--primary); }
    .medal { font-size: 1.5rem; margin-right: 1.5rem; flex-shrink: 0; width: 40px; text-align: center; }
    .rating-details { flex-grow: 1; }
    .rating-name { font-weight: 600; color: var(--primary); margin-bottom: 0.25rem; font-size: 1.1rem; }
    .rating-count { color: var(--text-light); font-size: 0.95rem; display: flex; align-items: center; gap: 0.5rem; }
    .rating-count i { color: var(--accent); }
    .progress-bar { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin-top: 0.5rem; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); border-radius: 3px; }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in { animation: fadeIn 0.6s ease-out forwards; }
    .loading, .error { text-align: center; color: var(--text-light); font-size: 1.1rem; padding: 2rem 0; }
  </style>
</head>
<body>
  <div class="app-container">
    <header class="header fade-in">
      <a href="index.html" class="logo">
        <i class="fas fa-crown logo-icon"></i> OcL Link
      </a>
      <a href="index.html" class="back-btn">
        <i class="fas fa-home"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
      </a>
    </header>

    <section class="rating-section fade-in">
      <div class="rating-container">
        <h2 class="section-title">
          <i class="fas fa-trophy"></i> –†–µ–π—Ç–∏–Ω–≥ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        </h2>
        
        <div class="filter-container">
          <label for="restaurantFilter">–§–∏–ª—å—Ç—Ä –ø–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É</label>
          <select id="restaurantFilter" disabled>
            <option value="all">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤...</option>
          </select>
        </div>

        <div id="employeeList">
          <div class="loading">
            <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    const employeeListContainer = document.getElementById("employeeList");
    const filterSelect = document.getElementById("restaurantFilter");
    let allEmployees = [];

    function displayEmployees(employees) {
      if (!employees || employees.length === 0) {
        employeeListContainer.innerHTML = '<div class="error">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
        return;
      }

      const sortedData = employees.sort((a, b) => b.count - a.count);
      const maxCount = sortedData.length > 0 ? sortedData[0].count : 1;
      
      let html = '';
      const medals = ['ü•á', 'ü•à', 'ü•â'];
      
      sortedData.forEach((employee, index) => {
        const percentage = maxCount > 0 ? (employee.count / maxCount) * 100 : 0;
        
        html += `
          <div class="rating-item fade-in" style="animation-delay: ${index * 0.05}s">
            <span class="medal">${medals[index] || `${index + 1}.`}</span>
            <div class="rating-details">
              <div class="rating-name">${employee.name}</div>
              <div class="rating-count">
                <i class="fas fa-chart-line"></i> ${employee.count} –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${percentage}%"></div>
              </div>
            </div>
          </div>`;
      });

      employeeListContainer.innerHTML = html;
    }

    function populateFilter(employees) {
        const restaurantNames = [...new Set(employees.map(e => e.restaurant))].filter(Boolean).sort();
        filterSelect.innerHTML = '<option value="all">–í—Å–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã</option>';
        restaurantNames.forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            filterSelect.appendChild(option);
        });
        filterSelect.disabled = false;
    }

    // –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ URL –Ω–∞ –Ω–æ–≤—ã–π URL –≤–∞—à–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxGfo2Qlki7yRKIcf-CPsGDF-YQAW4W21jB0G4Tu8mcy7I-7dBT9bHa8FMhmWZwrsEo/exec";

    fetch(SCRIPT_URL)
      .then(res => res.json())
      .then(data => {
        allEmployees = data;
        populateFilter(allEmployees);
        displayEmployees(allEmployees); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      })
      .catch(err => {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", err);
        employeeListContainer.innerHTML = `<div class="error"><i class="fas fa-exclamation-circle"></i> –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞</div>`;
      });
      
    filterSelect.addEventListener('change', (event) => {
      const selectedRestaurant = event.target.value;
      if (selectedRestaurant === 'all') {
        displayEmployees(allEmployees);
      } else {
        const filteredEmployees = allEmployees.filter(emp => emp.restaurant === selectedRestaurant);
        displayEmployees(filteredEmployees);
      }
    });
  </script>
</body>
</html>
